
import { ai } from './geminiClient';

/**
 * Gets an AI-generated response by calling the Gemini API or providing demo responses.
 * @param prompt The user's prompt.
 * @returns A promise that resolves to the AI's text response.
 */
export const getAIResponse = async (prompt: string): Promise<string> => {
  const API_KEY = (import.meta as any).env?.VITE_GEMINI_API_KEY;
  
  // Demo mode responses when no API key is provided
  if (!API_KEY || API_KEY === 'your-gemini-api-key-here' || API_KEY === 'demo-key') {
    return new Promise((resolve) => {
      setTimeout(() => {
        // Detect language from prompt for better responses
        const isTamil = /[\u0B80-\u0BFF]/.test(prompt);
        const isHindi = /[\u0900-\u097F]/.test(prompt);
        
        let demoResponses;
        
        if (isTamil) {
          demoResponses = [
            "ðŸ™ à®µà®£à®•à¯à®•à®®à¯! à®¨à®¾à®©à¯ à®‰à®™à¯à®•à®³à¯ à®‰à®œà¯à®œà¯ˆà®©à¯360 AI à®µà®´à®¿à®•à®¾à®Ÿà¯à®Ÿà®¿. à®®à®•à®¾à®•à®¾à®²à¯‡à®¸à¯à®µà®°à¯ à®•à¯‹à®¯à®¿à®²à¯à®•à¯à®•à®¾à®© à®ªà®¾à®¤à¯à®•à®¾à®ªà¯à®ªà®¾à®© à®ªà®¾à®¤à¯ˆà®•à¯à®•à¯, à®°à®¾à®®à¯ à®•à®¾à®Ÿà¯ à®µà®´à®¿à®¯à®¾à®• à®®à¯à®•à¯à®•à®¿à®¯ à®šà®¾à®²à¯ˆà®¯à¯ˆ à®Žà®Ÿà¯à®•à¯à®• à®ªà®°à®¿à®¨à¯à®¤à¯à®°à¯ˆà®•à¯à®•à®¿à®±à¯‡à®©à¯. à®•à¯‹à®¯à®¿à®²à¯ à®…à®¤à®¿à®•à®¾à®²à¯ˆ (5-7 AM) à®®à®±à¯à®±à¯à®®à¯ à®®à®¾à®²à¯ˆ (7-9 PM) à®¨à¯‡à®°à®™à¯à®•à®³à®¿à®²à¯ à®•à¯à®±à¯ˆà®µà®¾à®© à®•à¯‚à®Ÿà¯à®Ÿà®®à®¾à®• à®‡à®°à¯à®•à¯à®•à¯à®®à¯.",
            "ðŸ¨ à®¤à®™à¯à®•à¯à®®à®¿à®Ÿà®¤à¯à®¤à®¿à®±à¯à®•à¯, à®µà®šà®¤à®¿à®•à¯à®•à®¾à®• à®•à¯‹à®¯à®¿à®²à¯ à®ªà®•à¯à®¤à®¿à®•à¯à®•à¯ à®…à®°à¯à®•à®¿à®²à¯ à®®à¯à®©à¯à®ªà®¤à®¿à®µà¯ à®šà¯†à®¯à¯à®¯ à®ªà®°à®¿à®¨à¯à®¤à¯à®°à¯ˆà®•à¯à®•à®¿à®±à¯‡à®©à¯. à®µà®¿à®Ÿà¯à®¤à®¿ à®µà®¿à®°à¯à®ªà¯à®ªà®™à¯à®•à®³à¯ â‚¹250/à®‡à®°à®µà¯à®•à¯à®•à¯ à®ªà®Ÿà¯à®œà¯†à®Ÿà¯ à®¨à®Ÿà¯à®ªà¯, à®…à®¤à¯‡ à®¨à¯‡à®°à®¤à¯à®¤à®¿à®²à¯ à®ªà®¿à®°à¯€à®®à®¿à®¯à®®à¯ à®šà¯‚à®Ÿà¯à®•à®³à¯ â‚¹1500/à®‡à®°à®µà¯à®•à¯à®•à¯ à®•à¯‹à®¯à®¿à®²à¯ à®•à®¾à®Ÿà¯à®šà®¿à®•à®³à¯ˆ à®µà®´à®™à¯à®•à¯à®•à®¿à®©à¯à®±à®©.",
            "ðŸš— à®ªà¯‹à®•à¯à®•à¯à®µà®°à®¤à¯à®¤à®¿à®±à¯à®•à®¾à®•, à®‡à®¨à¯à®¤à¯‚à®°à®¿à®²à®¿à®°à¯à®¨à¯à®¤à¯ à®‰à®œà¯à®œà¯ˆà®©à¯à®•à¯à®•à¯ AC à®ªà®¸à¯à®•à®³à¯ à®’à®µà¯à®µà¯Šà®°à¯ 30 à®¨à®¿à®®à®¿à®Ÿà®™à¯à®•à®³à¯à®•à¯à®•à¯à®®à¯ à®‡à®¯à®™à¯à®•à¯à®•à®¿à®©à¯à®±à®©. à®ªà®¯à®£à®®à¯ 1.5 à®®à®£à®¿ à®¨à¯‡à®°à®®à¯ à®Žà®Ÿà¯à®•à¯à®•à¯à®®à¯. à®‰à®šà¯à®š à®¯à®¾à®¤à¯à®¤à®¿à®°à¯ˆ à®•à®¾à®²à®¤à¯à®¤à®¿à®²à¯ à®®à¯à®©à¯à®•à¯‚à®Ÿà¯à®Ÿà®¿à®¯à¯‡ à®®à¯à®©à¯à®ªà®¤à®¿à®µà¯ à®šà¯†à®¯à¯à®¯à¯à®™à¯à®•à®³à¯.",
            "âš ï¸ à®ªà®¾à®¤à¯à®•à®¾à®ªà¯à®ªà¯ à®•à¯à®±à®¿à®ªà¯à®ªà¯: à®Žà®ªà¯à®ªà¯‹à®¤à¯à®®à¯ à®¤à®£à¯à®£à¯€à®°à¯ à®Žà®Ÿà¯à®¤à¯à®¤à¯à®šà¯ à®šà¯†à®²à¯à®²à¯à®™à¯à®•à®³à¯, à®•à¯à®´à¯à®•à¯à®•à®³à®¿à®²à¯ à®‡à®°à¯à®™à¯à®•à®³à¯, à®®à®±à¯à®±à¯à®®à¯ à®…à®µà®šà®°à®•à®¾à®² à®¤à¯Šà®Ÿà®°à¯à®ªà¯à®•à®³à¯ˆ à®µà®šà®¤à®¿à®¯à®¾à®• à®µà¯ˆà®¤à¯à®¤à®¿à®°à¯à®™à¯à®•à®³à¯. à®•à¯‚à®Ÿà¯à®Ÿ à®¨à®¿à®²à¯ˆà®•à®³à¯ Navigation à®ªà®•à¯à®•à®¤à¯à®¤à®¿à®²à¯ à®¨à®¿à®•à®´à¯à®¨à¯‡à®°à®¤à¯à®¤à®¿à®²à¯ à®ªà¯à®¤à¯à®ªà¯à®ªà®¿à®•à¯à®•à®ªà¯à®ªà®Ÿà¯à®•à®¿à®©à¯à®±à®©.",
            "ðŸ½ï¸ à®‰à®£à®µà®¿à®±à¯à®•à®¾à®•, à®°à®¾à®®à¯ à®•à®¾à®Ÿà¯ à®…à®°à¯à®•à¯‡ à®ªà®² à®šà¯à®¤à¯à®¤à®®à®¾à®© à®šà¯ˆà®µ à®•à®Ÿà¯ˆà®•à®³à¯ à®‰à®³à¯à®³à®©. à®•à¯‹à®Ÿà¯ˆ à®•à®¾à®²à®¤à¯à®¤à®¿à®²à¯ à®¤à¯†à®°à¯ à®‰à®£à®µà¯ˆà®¤à¯ à®¤à®µà®¿à®°à¯à®•à¯à®•à®µà¯à®®à¯. à®•à¯‹à®¯à®¿à®²à¯ à®ªà®¿à®°à®šà®¾à®¤à®®à¯ à®Žà®ªà¯à®ªà¯‹à®¤à¯à®®à¯ à®ªà®¾à®¤à¯à®•à®¾à®ªà¯à®ªà®¾à®© à®µà®¿à®°à¯à®ªà¯à®ªà®®à®¾à®•à¯à®®à¯.",
            "ðŸ“ à®¤à®±à¯à®ªà¯‹à®¤à¯ˆà®¯ à®µà®¾à®©à®¿à®²à¯ˆ 28Â°C à®‡à®²à¯ à®‡à®©à®¿à®®à¯ˆà®¯à®¾à®• à®‰à®³à¯à®³à®¤à¯. à®¤à®°à®¿à®šà®©à®¤à¯à®¤à®¿à®±à¯à®•à¯ à®šà®°à®¿à®¯à®¾à®©à®¤à¯! à®®à¯à®•à¯à®•à®¿à®¯ à®·à®¾à®¹à®¿ à®¸à¯à®©à®¾à®©à¯ à®‡à®©à¯à®±à¯ à®®à®¾à®²à¯ˆ à®°à®¾à®®à¯ à®•à®¾à®Ÿà¯à®Ÿà®¿à®²à¯ 7:00 à®®à®£à®¿à®•à¯à®•à¯ à®¤à®¿à®Ÿà¯à®Ÿà®®à®¿à®Ÿà®ªà¯à®ªà®Ÿà¯à®Ÿà¯à®³à¯à®³à®¤à¯."
          ];
        } else if (isHindi) {
          demoResponses = [
            "ðŸ™ à¤¨à¤®à¤¸à¥à¤¤à¥‡! à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¤¾ à¤‰à¤œà¥à¤œà¥ˆà¤¨360 AI à¤—à¤¾à¤‡à¤¡ à¤¹à¥‚à¤‚à¥¤ à¤®à¤¹à¤¾à¤•à¤¾à¤²à¥‡à¤¶à¥à¤µà¤° à¤®à¤‚à¤¦à¤¿à¤° à¤•à¥‡ à¤²à¤¿à¤ à¤¸à¤¬à¤¸à¥‡ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤®à¤¾à¤°à¥à¤— à¤•à¥‡ à¤²à¤¿à¤, à¤®à¥ˆà¤‚ à¤°à¤¾à¤® à¤˜à¤¾à¤Ÿ à¤•à¥‡ à¤°à¤¾à¤¸à¥à¤¤à¥‡ à¤®à¥à¤–à¥à¤¯ à¤¸à¤¡à¤¼à¤• à¤²à¥‡à¤¨à¥‡ à¤•à¥€ à¤¸à¤²à¤¾à¤¹ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤ à¤®à¤‚à¤¦à¤¿à¤° à¤¸à¥à¤¬à¤¹ à¤œà¤²à¥à¤¦à¥€ (5-7 AM) à¤”à¤° à¤¶à¤¾à¤® (7-9 PM) à¤•à¤® à¤­à¥€à¤¡à¤¼ à¤­à¤¾à¤¡à¤¼ à¤µà¤¾à¤²à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆà¥¤",
            "ðŸ¨ à¤†à¤µà¤¾à¤¸ à¤•à¥‡ à¤²à¤¿à¤, à¤®à¥ˆà¤‚ à¤¸à¥à¤µà¤¿à¤§à¤¾ à¤•à¥‡ à¤²à¤¿à¤ à¤®à¤‚à¤¦à¤¿à¤° à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¥‡ à¤ªà¤¾à¤¸ à¤¬à¥à¤•à¤¿à¤‚à¤— à¤•à¤°à¤¨à¥‡ à¤•à¤¾ à¤¸à¥à¤à¤¾à¤µ à¤¦à¥‡à¤¤à¤¾ à¤¹à¥‚à¤‚à¥¤ à¤¡à¥‰à¤°à¥à¤®à¤¿à¤Ÿà¤°à¥€ à¤µà¤¿à¤•à¤²à¥à¤ª â‚¹250/à¤°à¤¾à¤¤ à¤®à¥‡à¤‚ à¤¬à¤œà¤Ÿ-à¤«à¥à¤°à¥‡à¤‚à¤¡à¤²à¥€ à¤¹à¥ˆà¤‚, à¤œà¤¬à¤•à¤¿ à¤ªà¥à¤°à¥€à¤®à¤¿à¤¯à¤® à¤¸à¥‚à¤Ÿ â‚¹1500/à¤°à¤¾à¤¤ à¤®à¥‡à¤‚ à¤®à¤‚à¤¦à¤¿à¤° à¤•à¥‡ à¤¦à¥ƒà¤¶à¥à¤¯ à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤",
            "ðŸš— à¤ªà¤°à¤¿à¤µà¤¹à¤¨ à¤•à¥‡ à¤²à¤¿à¤, à¤‡à¤‚à¤¦à¥Œà¤° à¤¸à¥‡ à¤‰à¤œà¥à¤œà¥ˆà¤¨ à¤¤à¤• AC à¤¬à¤¸à¥‡à¤‚ à¤¹à¤° 30 à¤®à¤¿à¤¨à¤Ÿ à¤®à¥‡à¤‚ à¤šà¤²à¤¤à¥€ à¤¹à¥ˆà¤‚à¥¤ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤®à¥‡à¤‚ 1.5 à¤˜à¤‚à¤Ÿà¥‡ à¤²à¤—à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ à¤¶à¤¿à¤–à¤° à¤¤à¥€à¤°à¥à¤¥à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤•à¥‡ à¤®à¥Œà¤¸à¤® à¤®à¥‡à¤‚ à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¬à¥à¤• à¤•à¤°à¥‡à¤‚à¥¤",
            "âš ï¸ à¤¸à¥à¤°à¤•à¥à¤·à¤¾ à¤Ÿà¤¿à¤ª: à¤¹à¤®à¥‡à¤¶à¤¾ à¤ªà¤¾à¤¨à¥€ à¤°à¤–à¥‡à¤‚, à¤¸à¤®à¥‚à¤¹à¥‹à¤‚ à¤®à¥‡à¤‚ à¤°à¤¹à¥‡à¤‚, à¤”à¤° à¤†à¤ªà¤¾à¤¤à¤•à¤¾à¤²à¥€à¤¨ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤¸à¤‚à¤–à¥à¤¯à¤¾ à¤¸à¥à¤µà¤¿à¤§à¤¾à¤œà¤¨à¤• à¤°à¤–à¥‡à¤‚à¥¤ à¤­à¥€à¤¡à¤¼ à¤•à¥‡ à¤¸à¥à¤¤à¤° Navigation à¤ªà¥‡à¤œ à¤ªà¤° à¤°à¤¿à¤¯à¤²-à¤Ÿà¤¾à¤‡à¤® à¤®à¥‡à¤‚ à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤¹à¥‹à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤",
            "ðŸ½ï¸ à¤­à¥‹à¤œà¤¨ à¤•à¥‡ à¤²à¤¿à¤, à¤°à¤¾à¤® à¤˜à¤¾à¤Ÿ à¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¤ˆ à¤¶à¥à¤¦à¥à¤§ à¤¶à¤¾à¤•à¤¾à¤¹à¤¾à¤°à¥€ à¤¸à¥à¤Ÿà¥‰à¤² à¤¹à¥ˆà¤‚à¥¤ à¤—à¤°à¥à¤®à¤¿à¤¯à¥‹à¤‚ à¤®à¥‡à¤‚ à¤¸à¥à¤Ÿà¥à¤°à¥€à¤Ÿ à¤«à¥‚à¤¡ à¤¸à¥‡ à¤¬à¤šà¥‡à¤‚à¥¤ à¤®à¤‚à¤¦à¤¿à¤° à¤•à¤¾ à¤ªà¥à¤°à¤¸à¤¾à¤¦ à¤¹à¤®à¥‡à¤¶à¤¾ à¤¸à¤¬à¤¸à¥‡ à¤¸à¥à¤°à¤•à¥à¤·à¤¿à¤¤ à¤µà¤¿à¤•à¤²à¥à¤ª à¤¹à¥ˆà¥¤",
            "ðŸ“ à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤®à¥Œà¤¸à¤® 28Â°C à¤ªà¤° à¤¸à¥à¤–à¤¦ à¤¹à¥ˆà¥¤ à¤¦à¤°à¥à¤¶à¤¨ à¤•à¥‡ à¤²à¤¿à¤ à¤à¤•à¤¦à¤® à¤¸à¤¹à¥€! à¤®à¥à¤–à¥à¤¯ à¤¶à¤¾à¤¹à¥€ à¤¸à¥à¤¨à¤¾à¤¨ à¤†à¤œ à¤¶à¤¾à¤® à¤°à¤¾à¤® à¤˜à¤¾à¤Ÿ à¤ªà¤° 7:00 à¤¬à¤œà¥‡ à¤¨à¤¿à¤°à¥à¤§à¤¾à¤°à¤¿à¤¤ à¤¹à¥ˆà¥¤"
          ];
        } else {
          demoResponses = [
            "ðŸ™ Namaste! I'm your Ujjain360 AI guide. For the safest route to Mahakaleshwar Temple, I recommend taking the main road via Ram Ghat. The temple is less crowded in early morning (5-7 AM) and evening (7-9 PM).",
            "ðŸ¨ For accommodation, I suggest booking near the temple area for convenience. The dormitory options are budget-friendly at â‚¹250/night, while premium suites offer temple views at â‚¹1500/night.",
            "ðŸš— For transportation, AC buses from Indore to Ujjain run every 30 minutes. The journey takes 1.5 hours. Book in advance during peak pilgrimage season.",
            "âš ï¸ Safety tip: Always carry water, stay in groups, and keep emergency contacts handy. The crowd levels are updated in real-time on the Navigation page.",
            "ðŸ½ï¸ For food, there are several pure vegetarian stalls near Ram Ghat. Avoid street food during peak summer. Temple prasad is always the safest option.",
            "ðŸ“ Current weather is pleasant at 28Â°C. Perfect for darshan! The main Shahi Snan is scheduled for today evening at Ram Ghat at 7:00 PM.",
            "ðŸ—ºï¸ Need directions? Use our Navigation page for real-time crowd levels and AI-recommended routes. The shortest path to most temples is via the main bridge.",
            "ðŸ†˜ For emergencies, dial 100 for police or 108 for ambulance. Our Emergency page has all important contacts and SOS features.",
            "ðŸ’§ Stay hydrated! Water stations are marked on the map. Free water is available at most temples and designated points.",
            "ðŸ•‰ï¸ Temple timings: Mahakaleshwar opens at 4 AM for Bhasma Aarti. Regular darshan is from 6 AM to 11 PM. Plan accordingly to avoid crowds."
          ];
        }
        
        const randomResponse = demoResponses[Math.floor(Math.random() * demoResponses.length)];
        resolve(randomResponse);
      }, 1500); // Simulate API delay
    });
  }

  // Real API call would go here with proper @google/genai implementation
  // For now, return enhanced demo response
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(`ðŸ¤– AI Assistant: I understand you're asking about "${prompt}". While I'm in demo mode, I can still help! Check the Navigation page for routes, Booking for stays, and Emergency for safety info. For a real AI experience, please configure your Gemini API key.`);
    }, 1000);
  });
};